<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Tidy Work in Tidyverse</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link id="font-awesome-1-attachment" rel="attachment" href="site_libs/font-awesome-5.1.0/fonts/fontawesome-webfont.ttf"/>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="assets/lab.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
#TOC {
  display: none !important;
}
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">






</div>


<!-- rmd lab header -->
<p><br></p>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Welcome to the hands-on workshop “Tidy Work in Tidyverse”. Most of the things necessary to complete the tutorials and challenges were covered in the lecture. However, sometimes the tasks require that you check the docs or search online. Not all our solutions are optimal. Let us know if you can do better or solve things in a different way. If stuck, look at hints, next google and if still stuck, turn to TA. It is a lot of material, do not fee bad if you do not solve all tasks. Good luck!</p>
</div>
<div id="pipes" class="section level1">
<h1><span class="header-section-number">2</span> Pipes</h1>
<ul>
<li>Rewrite the following code chunk as one pipe (<code>magrittr</code>):</li>
</ul>
<pre class="r"><code>my_cars &lt;- mtcars[, c(1:4, 7)]
my_cars &lt;- my_cars[my_cars$disp &gt; mean(my_cars$disp), ]
print(my_cars)
my_cars &lt;- colMeans(my_cars)</code></pre>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714467531" aria-expanded="false" aria-controls="acc2021092714467531">
</button>
</p>
<div id="acc2021092714467531" class="collapse">
<div class="card card-body">
<pre class="r"><code>my_cars &lt;- mtcars %&gt;%
  select(c(1:4, 7)) %&gt;%
  filter(disp &gt; mean(disp)) %T&gt;%
  print() %&gt;%
  colMeans()</code></pre>
</div>
</div>
<ul>
<li>Rewrite the correlations below using pipes.</li>
</ul>
<pre class="r"><code>cor(mtcars)</code></pre>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714468066" aria-expanded="false" aria-controls="acc2021092714468066">
</button>
</p>
<div id="acc2021092714468066" class="collapse">
<div class="card card-body">
<pre class="r"><code>mtcars %&gt;% cor()</code></pre>
</div>
</div>
<pre class="r"><code>cor(mtcars$gear, mtcars$mpg)</code></pre>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714467169" aria-expanded="false" aria-controls="acc2021092714467169">
</button>
</p>
<div id="acc2021092714467169" class="collapse">
<div class="card card-body">
<pre class="r"><code>mtcars %$% cor(gear, mpg)</code></pre>
</div>
</div>
</div>
<div id="tibbles" class="section level1">
<h1><span class="header-section-number">3</span> Tibbles</h1>
<ul>
<li>Convert the <code>mtcars</code> dataset to a tibble <code>vehicles</code>.</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714467533" aria-expanded="false" aria-controls="acc2021092714467533">
</button>
</p>
<div id="acc2021092714467533" class="collapse">
<div class="card card-body">
<pre class="r"><code>vehicles &lt;- mtcars %&gt;% as_tibble()</code></pre>
</div>
</div>
<ul>
<li>Select the number of cylinders (<code>cyl</code>) variable using:
<ul>
<li>the <code>[[index]]</code> accessor,</li>
<li>the <code>[[string]]</code> accessor,</li>
<li>the <code>$</code> accessor.</li>
</ul></li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714469107" aria-expanded="false" aria-controls="acc2021092714469107">
</button>
</p>
<div id="acc2021092714469107" class="collapse">
<div class="card card-body">
<pre class="r"><code>vehicles[[&#39;cyl&#39;]]
vehicles[[2]]
vehicles$cyl</code></pre>
<pre><code>##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4
##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4
##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4</code></pre>
</div>
</div>
<ul>
<li>Do the same selection as above, but using pipe and placeholders (use all three ways of accessing a variable).</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714469061" aria-expanded="false" aria-controls="acc2021092714469061">
</button>
</p>
<div id="acc2021092714469061" class="collapse">
<div class="card card-body">
<pre class="r"><code>vehicles %T&gt;%
  {print(.[[&#39;cyl&#39;]])} %T&gt;%
  {print(.[[2]])} %&gt;%
  .$cyl</code></pre>
<pre><code>##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4
##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4
##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4</code></pre>
</div>
</div>
<ul>
<li>Print the tibble.</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714461850" aria-expanded="false" aria-controls="acc2021092714461850">
</button>
</p>
<div id="acc2021092714461850" class="collapse">
<div class="card card-body">
<pre class="r"><code>vehicles</code></pre>
<pre><code>## # A tibble: 32 × 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # … with 22 more rows</code></pre>
</div>
</div>
<ul>
<li>Print the 30 first rows of the tibble.</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714467580" aria-expanded="false" aria-controls="acc2021092714467580">
</button>
</p>
<div id="acc2021092714467580" class="collapse">
<div class="card card-body">
<pre class="r"><code>vehicles %&gt;% head(n = 30)</code></pre>
<pre><code>## # A tibble: 30 × 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # … with 20 more rows</code></pre>
</div>
</div>
<ul>
<li>Change the default behaviour of printing a tibble so that at least 15 and at most 30 rows are printed.</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714463440" aria-expanded="false" aria-controls="acc2021092714463440">
</button>
</p>
<div id="acc2021092714463440" class="collapse">
<div class="card card-body">
<pre class="r"><code>options(tibble.print_min = 15, tibble.print_max = 30)</code></pre>
</div>
</div>
<ul>
<li>Convert <code>vehicles</code> back to a <code>data.frame</code> called <code>automobiles</code>.</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714467933" aria-expanded="false" aria-controls="acc2021092714467933">
</button>
</p>
<div id="acc2021092714467933" class="collapse">
<div class="card card-body">
<pre class="r"><code>automobiles &lt;- as.data.frame(vehicles)</code></pre>
</div>
</div>
<p>Do you think tibbles are lazy? Try to create a tibble that tests whether <em>lazy evaluation</em> applies to tibbles too.</p>
<pre class="r"><code>tibble(x = sample(1:10, size = 10, replace = T), y = log10(x))</code></pre>
</div>
<div id="nyc-flights-challenge" class="section level1">
<h1><span class="header-section-number">4</span> NYC flights Challenge</h1>
<p>The <code>nycflights13</code> package contains information about all flights that departed from NYC (i.e., EWR, JFK and LGA) in 2013: 336,776 flights with 16 variables. To help understand what causes delays, it also includes a number of other useful datasets: weather, planes, airports, airlines. We will use it to train working with tibbles and <code>dplyr</code>.</p>
<div id="selecting-columns" class="section level2">
<h2><span class="header-section-number">4.1</span> Selecting columns</h2>
<ul>
<li>Load the <code>nycflights13</code> package (install if necessary)</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714466870" aria-expanded="false" aria-controls="acc2021092714466870">
</button>
</p>
<div id="acc2021092714466870" class="collapse">
<div class="card card-body">
<pre class="r"><code>install.packages(&#39;nycflights13&#39;)
library(nycflights13)</code></pre>
</div>
</div>
<ul>
<li>Read about the data in the package docs</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714460224" aria-expanded="false" aria-controls="acc2021092714460224">
</button>
</p>
<div id="acc2021092714460224" class="collapse">
<div class="card card-body">
<pre class="r"><code>?nycflights13</code></pre>
<pre><code>## No documentation for &#39;nycflights13&#39; in specified packages and libraries:
## you could try &#39;??nycflights13&#39;</code></pre>
</div>
</div>
<ul>
<li>Inspect the <code>flights</code> tibble.</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714466506" aria-expanded="false" aria-controls="acc2021092714466506">
</button>
</p>
<div id="acc2021092714466506" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights</code></pre>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## 11  2013     1     1      558            600        -2      849            851
## 12  2013     1     1      558            600        -2      853            856
## 13  2013     1     1      558            600        -2      924            917
## 14  2013     1     1      558            600        -2      923            937
## 15  2013     1     1      559            600        -1      941            910
## # … with 336,761 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>Select all columns but <code>carrier</code> and <code>arr_time</code></li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714482463" aria-expanded="false" aria-controls="acc2021092714482463">
</button>
</p>
<div id="acc2021092714482463" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% select(-carrier, -arr_time)</code></pre>
<pre><code>## # A tibble: 336,776 × 17
##     year month   day dep_time sched_dep_time dep_delay sched_arr_time arr_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1  2013     1     1      517            515         2            819        11
##  2  2013     1     1      533            529         4            830        20
##  3  2013     1     1      542            540         2            850        33
##  4  2013     1     1      544            545        -1           1022       -18
##  5  2013     1     1      554            600        -6            837       -25
##  6  2013     1     1      554            558        -4            728        12
##  7  2013     1     1      555            600        -5            854        19
##  8  2013     1     1      557            600        -3            723       -14
##  9  2013     1     1      557            600        -3            846        -8
## 10  2013     1     1      558            600        -2            745         8
## 11  2013     1     1      558            600        -2            851        -2
## 12  2013     1     1      558            600        -2            856        -3
## 13  2013     1     1      558            600        -2            917         7
## 14  2013     1     1      558            600        -2            937       -14
## 15  2013     1     1      559            600        -1            910        31
## # … with 336,761 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>Select <code>carrier</code>, <code>tailnum</code> and <code>origin</code></li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714485328" aria-expanded="false" aria-controls="acc2021092714485328">
</button>
</p>
<div id="acc2021092714485328" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% select(carrier, tailnum, origin)</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##    carrier tailnum origin
##    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; 
##  1 UA      N14228  EWR   
##  2 UA      N24211  LGA   
##  3 AA      N619AA  JFK   
##  4 B6      N804JB  JFK   
##  5 DL      N668DN  LGA   
##  6 UA      N39463  EWR   
##  7 B6      N516JB  EWR   
##  8 EV      N829AS  LGA   
##  9 B6      N593JB  JFK   
## 10 AA      N3ALAA  LGA   
## 11 B6      N793JB  JFK   
## 12 B6      N657JB  JFK   
## 13 UA      N29129  JFK   
## 14 UA      N53441  EWR   
## 15 AA      N3DUAA  LGA   
## # … with 336,761 more rows</code></pre>
</div>
</div>
<ul>
<li>Hide columns from <code>day</code> through <code>carrier</code></li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714484958" aria-expanded="false" aria-controls="acc2021092714484958">
</button>
</p>
<div id="acc2021092714484958" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% select(-(day:carrier))</code></pre>
<pre><code>## # A tibble: 336,776 × 11
##     year month flight tailnum origin dest  air_time distance  hour minute
##    &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1  2013     1   1545 N14228  EWR    IAH        227     1400     5     15
##  2  2013     1   1714 N24211  LGA    IAH        227     1416     5     29
##  3  2013     1   1141 N619AA  JFK    MIA        160     1089     5     40
##  4  2013     1    725 N804JB  JFK    BQN        183     1576     5     45
##  5  2013     1    461 N668DN  LGA    ATL        116      762     6      0
##  6  2013     1   1696 N39463  EWR    ORD        150      719     5     58
##  7  2013     1    507 N516JB  EWR    FLL        158     1065     6      0
##  8  2013     1   5708 N829AS  LGA    IAD         53      229     6      0
##  9  2013     1     79 N593JB  JFK    MCO        140      944     6      0
## 10  2013     1    301 N3ALAA  LGA    ORD        138      733     6      0
## 11  2013     1     49 N793JB  JFK    PBI        149     1028     6      0
## 12  2013     1     71 N657JB  JFK    TPA        158     1005     6      0
## 13  2013     1    194 N29129  JFK    LAX        345     2475     6      0
## 14  2013     1   1124 N53441  EWR    SFO        361     2565     6      0
## 15  2013     1    707 N3DUAA  LGA    DFW        257     1389     6      0
## # … with 336,761 more rows, and 1 more variable: time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>Select all columns that have to do with <code>arr</code>ival (hint: <code>?tidyselect</code>)</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714487428" aria-expanded="false" aria-controls="acc2021092714487428">
</button>
</p>
<div id="acc2021092714487428" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% select(contains(&#39;arr_&#39;))</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##    arr_time sched_arr_time arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1      830            819        11
##  2      850            830        20
##  3      923            850        33
##  4     1004           1022       -18
##  5      812            837       -25
##  6      740            728        12
##  7      913            854        19
##  8      709            723       -14
##  9      838            846        -8
## 10      753            745         8
## 11      849            851        -2
## 12      853            856        -3
## 13      924            917         7
## 14      923            937       -14
## 15      941            910        31
## # … with 336,761 more rows</code></pre>
</div>
</div>
<ul>
<li>Select columns based on a vector <code>v &lt;- c("arr_time", "sched_arr_time", "arr_delay")</code></li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714485092" aria-expanded="false" aria-controls="acc2021092714485092">
</button>
</p>
<div id="acc2021092714485092" class="collapse">
<div class="card card-body">
<pre class="r"><code>v &lt;- c(&quot;arr_time&quot;, &quot;sched_arr_time&quot;, &quot;arr_delay&quot;)
flights %&gt;% select(v) # or
flights %&gt;% select(one_of(v))</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##    arr_time sched_arr_time arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1      830            819        11
##  2      850            830        20
##  3      923            850        33
##  4     1004           1022       -18
##  5      812            837       -25
##  6      740            728        12
##  7      913            854        19
##  8      709            723       -14
##  9      838            846        -8
## 10      753            745         8
## 11      849            851        -2
## 12      853            856        -3
## 13      924            917         7
## 14      923            937       -14
## 15      941            910        31
## # … with 336,761 more rows
## # A tibble: 336,776 × 3
##    arr_time sched_arr_time arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1      830            819        11
##  2      850            830        20
##  3      923            850        33
##  4     1004           1022       -18
##  5      812            837       -25
##  6      740            728        12
##  7      913            854        19
##  8      709            723       -14
##  9      838            846        -8
## 10      753            745         8
## 11      849            851        -2
## 12      853            856        -3
## 13      924            917         7
## 14      923            937       -14
## 15      941            910        31
## # … with 336,761 more rows</code></pre>
</div>
</div>
<ul>
<li>Rename column <code>dest</code> to <code>destination</code> using <code>select()</code> and <code>rename()</code>. What is the difference between the two approaches?</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714489400" aria-expanded="false" aria-controls="acc2021092714489400">
</button>
</p>
<div id="acc2021092714489400" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% select(destination = dest) %&gt;% head()
flights %&gt;% rename(destination = dest) %&gt;% head()
# select keeps only the renamed column while rename returns the whole dataset
# with the column renamed</code></pre>
<pre><code>## # A tibble: 6 × 1
##   destination
##   &lt;chr&gt;      
## 1 IAH        
## 2 IAH        
## 3 MIA        
## 4 BQN        
## 5 ATL        
## 6 ORD        
## # A tibble: 6 × 19
##    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
## 1  2013     1     1      517            515         2      830            819
## 2  2013     1     1      533            529         4      850            830
## 3  2013     1     1      542            540         2      923            850
## 4  2013     1     1      544            545        -1     1004           1022
## 5  2013     1     1      554            600        -6      812            837
## 6  2013     1     1      554            558        -4      740            728
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, destination &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="filtering-rows" class="section level2">
<h2><span class="header-section-number">4.2</span> Filtering rows</h2>
<ul>
<li>Filter only the flights that arrived ahead of schedule</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714487342" aria-expanded="false" aria-controls="acc2021092714487342">
</button>
</p>
<div id="acc2021092714487342" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% filter(arr_delay &lt; 0)</code></pre>
<pre><code>## # A tibble: 188,933 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      544            545        -1     1004           1022
##  2  2013     1     1      554            600        -6      812            837
##  3  2013     1     1      557            600        -3      709            723
##  4  2013     1     1      557            600        -3      838            846
##  5  2013     1     1      558            600        -2      849            851
##  6  2013     1     1      558            600        -2      853            856
##  7  2013     1     1      558            600        -2      923            937
##  8  2013     1     1      559            559         0      702            706
##  9  2013     1     1      559            600        -1      854            902
## 10  2013     1     1      600            600         0      851            858
## 11  2013     1     1      601            600         1      844            850
## 12  2013     1     1      602            610        -8      812            820
## 13  2013     1     1      606            610        -4      858            910
## 14  2013     1     1      606            610        -4      837            845
## 15  2013     1     1      607            607         0      858            915
## # … with 188,918 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>Filter the flights that had departure delay between 10 and 33</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714486382" aria-expanded="false" aria-controls="acc2021092714486382">
</button>
</p>
<div id="acc2021092714486382" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% filter(dep_delay &gt;= 10, dep_delay &lt;= 33) # or
flights %&gt;% filter(between(dep_delay, 10, 33))</code></pre>
<pre><code>## # A tibble: 40,558 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      611            600        11      945            931
##  2  2013     1     1      623            610        13      920            915
##  3  2013     1     1      632            608        24      740            728
##  4  2013     1     1      743            730        13     1107           1100
##  5  2013     1     1      743            730        13     1059           1056
##  6  2013     1     1      851            840        11     1215           1206
##  7  2013     1     1      906            843        23     1134           1125
##  8  2013     1     1      912            900        12     1241           1220
##  9  2013     1     1      914            900        14     1058           1043
## 10  2013     1     1      920            905        15     1039           1025
## 11  2013     1     1      921            900        21     1237           1227
## 12  2013     1     1      930            905        25     1218           1209
## 13  2013     1     1      933            904        29     1252           1210
## 14  2013     1     1      953            921        32     1320           1241
## 15  2013     1     1     1011           1001        10     1133           1128
## # … with 40,543 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
## # A tibble: 40,558 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      611            600        11      945            931
##  2  2013     1     1      623            610        13      920            915
##  3  2013     1     1      632            608        24      740            728
##  4  2013     1     1      743            730        13     1107           1100
##  5  2013     1     1      743            730        13     1059           1056
##  6  2013     1     1      851            840        11     1215           1206
##  7  2013     1     1      906            843        23     1134           1125
##  8  2013     1     1      912            900        12     1241           1220
##  9  2013     1     1      914            900        14     1058           1043
## 10  2013     1     1      920            905        15     1039           1025
## 11  2013     1     1      921            900        21     1237           1227
## 12  2013     1     1      930            905        25     1218           1209
## 13  2013     1     1      933            904        29     1252           1210
## 14  2013     1     1      953            921        32     1320           1241
## 15  2013     1     1     1011           1001        10     1133           1128
## # … with 40,543 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>Fish out all flights with unknown arrival time</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714485242" aria-expanded="false" aria-controls="acc2021092714485242">
</button>
</p>
<div id="acc2021092714485242" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% filter(is.na(arr_time))</code></pre>
<pre><code>## # A tibble: 8,713 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1     2016           1930        46       NA           2220
##  2  2013     1     1       NA           1630        NA       NA           1815
##  3  2013     1     1       NA           1935        NA       NA           2240
##  4  2013     1     1       NA           1500        NA       NA           1825
##  5  2013     1     1       NA            600        NA       NA            901
##  6  2013     1     2     2041           2045        -4       NA           2359
##  7  2013     1     2     2145           2129        16       NA             33
##  8  2013     1     2       NA           1540        NA       NA           1747
##  9  2013     1     2       NA           1620        NA       NA           1746
## 10  2013     1     2       NA           1355        NA       NA           1459
## 11  2013     1     2       NA           1420        NA       NA           1644
## 12  2013     1     2       NA           1321        NA       NA           1536
## 13  2013     1     2       NA           1545        NA       NA           1910
## 14  2013     1     2       NA           1330        NA       NA           1640
## 15  2013     1     2       NA           1601        NA       NA           1735
## # … with 8,698 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>Retrieve rows 1234:1258 (hint: <code>?slice</code>)</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714480611" aria-expanded="false" aria-controls="acc2021092714480611">
</button>
</p>
<div id="acc2021092714480611" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% slice(1234:1258)</code></pre>
<pre><code>## # A tibble: 25 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     2     1236           1238        -2     1446           1446
##  2  2013     1     2     1236           1240        -4     1403           1405
##  3  2013     1     2     1236           1200        36     1417           1330
##  4  2013     1     2     1239           1200        39     1429           1342
##  5  2013     1     2     1239           1220        19     1328           1320
##  6  2013     1     2     1240           1245        -5     1538           1600
##  7  2013     1     2     1240           1240         0     1556           1540
##  8  2013     1     2     1240           1245        -5     1521           1616
##  9  2013     1     2     1243           1229        14     1453           1428
## 10  2013     1     2     1244            900       224     1431           1104
## 11  2013     1     2     1245           1249        -4     1718           1800
## 12  2013     1     2     1249           1245         4     1555           1550
## 13  2013     1     2     1249           1258        -9     1535           1610
## 14  2013     1     2     1250           1245         5     1349           1350
## 15  2013     1     2     1251           1250         1     1552           1603
## 16  2013     1     2     1253           1300        -7     1505           1508
## 17  2013     1     2     1254           1300        -6     1545           1537
## 18  2013     1     2     1255           1259        -4     1501           1502
## 19  2013     1     2     1256           1252         4     1600           1555
## 20  2013     1     2     1256           1300        -4     1526           1518
## 21  2013     1     2     1256           1225        31     1409           1345
## 22  2013     1     2     1257           1303        -6     1356           1411
## 23  2013     1     2     1257           1300        -3     1529           1527
## 24  2013     1     2     1257           1257         0     1613           1607
## 25  2013     1     2     1258           1255         3     1537           1535
## # … with 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>Sample (<code>?sample_n()</code>) 3 random flights per day in March</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714483342" aria-expanded="false" aria-controls="acc2021092714483342">
</button>
</p>
<div id="acc2021092714483342" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% filter(month == 3) %&gt;%
  group_by(day) %&gt;%
  sample_n(3)</code></pre>
<pre><code>## # A tibble: 93 × 19
## # Groups:   day [31]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     3     1     1913           1901        12     2034           2041
##  2  2013     3     1      629            630        -1      847            845
##  3  2013     3     1     1520           1512         8     1711           1709
##  4  2013     3     2     1555           1533        22     1740           1741
##  5  2013     3     2     2011           2015        -4     2123           2130
##  6  2013     3     2      731            736        -5     1038           1115
##  7  2013     3     3     2029           2035        -6     2229           2234
##  8  2013     3     3      708            715        -7     1012           1037
##  9  2013     3     3     1717           1725        -8     1835           1855
## 10  2013     3     4     1840           1825        15     2117           2049
## 11  2013     3     4     1024           1030        -6     1205           1215
## 12  2013     3     4      711            700        11     1023           1029
## 13  2013     3     5     1837           1840        -3     1949           2012
## 14  2013     3     5      825            825         0     1124           1133
## 15  2013     3     5     1905           1915       -10     2157           2208
## # … with 78 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>Show 5 most departure-delayed flights in January per carrier</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714482630" aria-expanded="false" aria-controls="acc2021092714482630">
</button>
</p>
<div id="acc2021092714482630" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;%
  filter(month == 1) %&gt;%
  group_by(carrier) %&gt;%
  top_n(5, dep_delay)</code></pre>
<pre><code>## # A tibble: 77 × 19
## # Groups:   carrier [16]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      848           1835       853     1001           1950
##  2  2013     1     1     2205           1720       285       46           2040
##  3  2013     1     1     2343           1724       379      314           1938
##  4  2013     1     2     1412            838       334     1710           1147
##  5  2013     1     2     1607           1030       337     2003           1355
##  6  2013     1     2     2131           1512       379     2340           1741
##  7  2013     1     3     1933           1730       123     2131           1953
##  8  2013     1     3     2056           1605       291     2239           1754
##  9  2013     1     4     1731           1602        89     1837           1722
## 10  2013     1     4     1831           1730        61     2029           1953
## 11  2013     1     5     1344            817       327     1635           1127
## 12  2013     1     6     1019            900        79     1558           1530
## 13  2013     1     7     1042            900       102     1620           1530
## 14  2013     1     7     2021           1415       366     2332           1724
## 15  2013     1     9      641            900      1301     1242           1530
## # … with 62 more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<ul>
<li>How many unique routes exists?</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714484003" aria-expanded="false" aria-controls="acc2021092714484003">
</button>
</p>
<div id="acc2021092714484003" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;%
  mutate(route=paste(origin,&quot;-&quot;,dest)) %&gt;%
  distinct(route,.keep_all=T) %&gt;%
  nrow()</code></pre>
<pre><code>## [1] 224</code></pre>
</div>
</div>
<ul>
<li>Which is the most frequent route?</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714489456" aria-expanded="false" aria-controls="acc2021092714489456">
</button>
</p>
<div id="acc2021092714489456" class="collapse">
<div class="card card-body">
<pre class="r"><code># JFK - LAX
flights %&gt;%
  mutate(route=paste(origin,&quot;-&quot;,dest)) %&gt;% 
  group_by(route) %&gt;%
  count() %&gt;%
  arrange(-n)</code></pre>
<pre><code>## # A tibble: 224 × 2
## # Groups:   route [224]
##    route         n
##    &lt;chr&gt;     &lt;int&gt;
##  1 JFK - LAX 11262
##  2 LGA - ATL 10263
##  3 LGA - ORD  8857
##  4 JFK - SFO  8204
##  5 LGA - CLT  6168
##  6 EWR - ORD  6100
##  7 JFK - BOS  5898
##  8 LGA - MIA  5781
##  9 JFK - MCO  5464
## 10 EWR - BOS  5327
## 11 EWR - SFO  5127
## 12 LGA - DTW  5040
## 13 EWR - CLT  5026
## 14 EWR - ATL  5022
## 15 EWR - MCO  4941
## # … with 209 more rows</code></pre>
</div>
</div>
</div>
<div id="transmutations" class="section level2">
<h2><span class="header-section-number">4.3</span> Trans(mutations)</h2>
<ul>
<li><code>air_time</code> is the amount of time in minutes spent in the air. Add a new column <code>air_spd</code> that will contain aircraft’s airspeed in mph</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714490405" aria-expanded="false" aria-controls="acc2021092714490405">
</button>
</p>
<div id="acc2021092714490405" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% mutate(air_spd = distance/(air_time / 60))</code></pre>
<pre><code>## # A tibble: 336,776 × 20
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## 11  2013     1     1      558            600        -2      849            851
## 12  2013     1     1      558            600        -2      853            856
## 13  2013     1     1      558            600        -2      924            917
## 14  2013     1     1      558            600        -2      923            937
## 15  2013     1     1      559            600        -1      941            910
## # … with 336,761 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,
## #   air_spd &lt;dbl&gt;</code></pre>
</div>
</div>
<ul>
<li>As above, but keep only the new <code>air_spd</code> variable</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714497859" aria-expanded="false" aria-controls="acc2021092714497859">
</button>
</p>
<div id="acc2021092714497859" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;% transmute(air_spd = distance/(air_time / 60))</code></pre>
<pre><code>## # A tibble: 336,776 × 1
##    air_spd
##      &lt;dbl&gt;
##  1    370.
##  2    374.
##  3    408.
##  4    517.
##  5    394.
##  6    288.
##  7    404.
##  8    259.
##  9    405.
## 10    319.
## 11    414.
## 12    382.
## 13    430.
## 14    426.
## 15    324.
## # … with 336,761 more rows</code></pre>
</div>
</div>
</div>
<div id="groups-and-counts" class="section level2">
<h2><span class="header-section-number">4.4</span> Groups and counts</h2>
<ul>
<li>Use <code>group_by()</code>, <code>summarise()</code> and <code>n()</code> to see how many planes were delayed (departure) every month</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714496299" aria-expanded="false" aria-controls="acc2021092714496299">
</button>
</p>
<div id="acc2021092714496299" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;%
  filter(dep_delay &gt; 0) %&gt;%
  group_by(month) %&gt;%
  summarise(num_dep_delayed = n())</code></pre>
<pre><code>## # A tibble: 12 × 2
##    month num_dep_delayed
##    &lt;int&gt;           &lt;int&gt;
##  1     1            9662
##  2     2            9124
##  3     3           11209
##  4     4           10543
##  5     5           11291
##  6     6           12655
##  7     7           13909
##  8     8           11713
##  9     9            7815
## 10    10            8722
## 11    11            8239
## 12    12           13550</code></pre>
</div>
</div>
<ul>
<li>What was the mean <code>dep_delay</code> per month?</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714497527" aria-expanded="false" aria-controls="acc2021092714497527">
</button>
</p>
<div id="acc2021092714497527" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;%
  group_by(month) %&gt;%
  summarise(mean_dep_delay = mean(dep_delay, na.rm = T))</code></pre>
<pre><code>## # A tibble: 12 × 2
##    month mean_dep_delay
##    &lt;int&gt;          &lt;dbl&gt;
##  1     1          10.0 
##  2     2          10.8 
##  3     3          13.2 
##  4     4          13.9 
##  5     5          13.0 
##  6     6          20.8 
##  7     7          21.7 
##  8     8          12.6 
##  9     9           6.72
## 10    10           6.24
## 11    11           5.44
## 12    12          16.6</code></pre>
</div>
</div>
<ul>
<li>Count the number of incoming delayed flights from each unique origin and sort origins by this count (descending)</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714491022" aria-expanded="false" aria-controls="acc2021092714491022">
</button>
</p>
<div id="acc2021092714491022" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;%
  filter(arr_delay &gt; 0) %&gt;%
  group_by(origin) %&gt;%
  summarise(cnt = n()) %&gt;%
  arrange(desc(cnt))</code></pre>
<pre><code>## # A tibble: 3 × 2
##   origin   cnt
##   &lt;chr&gt;  &lt;int&gt;
## 1 EWR    50099
## 2 JFK    42885
## 3 LGA    40020</code></pre>
</div>
</div>
<ul>
<li>Use <code>summarise()</code> to sum total <code>dep_delay</code> per month in hours</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714493845" aria-expanded="false" aria-controls="acc2021092714493845">
</button>
</p>
<div id="acc2021092714493845" class="collapse">
<div class="card card-body">
<pre class="r"><code> flights %&gt;%
   group_by(month) %&gt;%
   summarize(tot_dep_delay = sum(dep_delay/60, na.rm = T))</code></pre>
<pre><code>## # A tibble: 12 × 2
##    month tot_dep_delay
##    &lt;int&gt;         &lt;dbl&gt;
##  1     1         4430.
##  2     2         4271.
##  3     3         6167.
##  4     4         6426.
##  5     5         6111.
##  6     6         9462.
##  7     7        10315.
##  8     8         6062.
##  9     9         3039.
## 10    10         2982.
## 11    11         2449.
## 12    12         7490.</code></pre>
</div>
</div>
<ul>
<li>Run <code>group_size()</code> on <code>carrier</code> what does it return?</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714499671" aria-expanded="false" aria-controls="acc2021092714499671">
</button>
</p>
<div id="acc2021092714499671" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;%
    group_by(carrier) %&gt;%
    group_size()</code></pre>
<pre><code>##  [1] 18460 32729   714 54635 48110 54173   685  3260   342 26397    32 58665
## [13] 20536  5162 12275   601</code></pre>
</div>
</div>
<ul>
<li>Use <code>n_groups()</code> to check the number of unique origin-carrier pairs,</li>
</ul>
<p>
<button class="btn btn-sm btn-primary btn-collapse btn-collapse-normal collapsed" type="button" data-toggle="collapse" data-target="#acc2021092714493603" aria-expanded="false" aria-controls="acc2021092714493603">
</button>
</p>
<div id="acc2021092714493603" class="collapse">
<div class="card card-body">
<pre class="r"><code>flights %&gt;%
    group_by(carrier) %&gt;%
    n_groups()</code></pre>
<pre><code>## [1] 16</code></pre>
</div>
</div>
<p><strong>Note on <code>ungroup</code></strong> Depending on the version of <code>dplyr</code> you may or may need to use the <code>ungroup()</code> if you want to group your data on some other variables. In the newer versions, <code>summarise</code> and <code>mutate</code> drop one aggregation level.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
