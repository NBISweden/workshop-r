<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Tidy work in Tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Marcin Kierczak" />
    <meta name="keywords" content="r, r programming, markdown, tidyverse" />
    <script src="site_libs/header-attrs-2.23/header-attrs.js"></script>
    <link href="site_libs/font-awesome-6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="site_libs/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet" />
    <link id="font-awesome-1-attachment" rel="attachment" href="site_libs/font-awesome-6.4.0/fonts/fontawesome-webfont.ttf"/>
    <script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/slide.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Tidy work in Tidyverse
]
.subtitle[
## R Foundation for Life Scientists
]
.author[
### Marcin Kierczak
]

---


exclude: true
count: false


&lt;link href="https://fonts.googleapis.com/css?family=Roboto|Source+Sans+Pro:300,400,600|Ubuntu+Mono&amp;amp;subset=latin-ext" rel="stylesheet"&gt;
&lt;link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous"&gt;





&lt;!-- ----------------- Only edit title &amp; author above this ----------------- --&gt;





# Tidyverse -- What is it all About?

* [Tidyverse](http://www.tidyverse.org) is a collection of packages.
* Created by [Hadley Wickham](http://hadley.nz).
* Gains popularity, on the way to become a *de facto* standard in data analyses.
* Knowing how to use it can increase your salary :-)
* A philosophy of programming or a programing paradigm.
* Everything is about the flow of *tidy data*.
.center[
&lt;img src="data/slide_tidyverse/hex-tidyverse.png", style="height:200px;"&gt;
&lt;img src="data/slide_tidyverse/Hadley-wickham2016-02-04.jpeg", style="height:200px;"&gt;
&lt;img src="data/slide_tidyverse/RforDataScience.jpeg", style="height:200px;"&gt;
]
.vsmall[sources of images: www.tidyverse.org, Wikipedia, www.tidyverse.org]

---
name: tidyverse_workflow

# Typical Tidyverse Workflow

The tidyverse curse?

--

&gt; Navigating the balance between base R and the tidyverse is a challenge to learn. [-Robert A. Muenchen](http://r4stats.com/articles/why-r-is-hard-to-learn/)

--

.center[&lt;img src="data/slide_tidyverse/tidyverse-flow.png", style="height:400px;"&gt;]

.vsmall[source: http://www.storybench.org/getting-started-with-tidyverse-in-r/]

---
name: intro_to_pipes

# Introduction to Pipes

.pull-left-50[

.center[&lt;img src="data/slide_tidyverse/pipe_magritte.jpg", style="width:300px;"&gt;]

.vsmall[Rene Magritt, *La trahison des images*, [Wikimedia Commons](https://en.wikipedia.org/wiki/The_Treachery_of_Images#/media/File:MagrittePipe.jpg)]

.center[&lt;img src="data/slide_tidyverse/magrittr.png", style="width:150px;"&gt;]
]

--

.pull-right-50[

* Let the data flow.
* *Ceci n'est pas une pipe* -- `magrittr`
* The `%&gt;%` pipe:
  + `x %&gt;% f` `\(\equiv\)` `f(x)`
  + `x %&gt;% f(y)` `\(\equiv\)` `f(x, y)`
  + `x %&gt;% f %&gt;% g %&gt;% h` `\(\equiv\)` `h(g(f(x)))`

]

--

.pull-right-50[

instead of writing this:


```r
data &lt;- iris
data &lt;- head(data, n=3)
```

]

--

.pull-right-50[

write this:


```r
iris %&gt;% head(n=3)
```

```
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
```

]


---
name: tibble_intro

# Tibbles

.pull-left-50[

.center[&lt;img src="data/slide_tidyverse/hex-tibble.png"&gt;]


```r
head(as_tibble(iris))
```

```
## # A tibble: 6 × 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
## 1          5.1         3.5          1.4         0.2 setosa 
## 2          4.9         3            1.4         0.2 setosa 
## 3          4.7         3.2          1.3         0.2 setosa 
## 4          4.6         3.1          1.5         0.2 setosa 
## 5          5           3.6          1.4         0.2 setosa 
## 6          5.4         3.9          1.7         0.4 setosa
```

]

.pull-right-50[

* `tibble` is one of the unifying features of tidyverse,
* it is a *better* `data.frame` realization,
* objects `data.frame` can be coerced to `tibble` using `as_tibble()`


```r
tibble(
  x = 1,          # recycling
  y = runif(8),
  z = x + y^2,
  outcome = rnorm(8)
)
```

```
## # A tibble: 8 × 4
##       x     y     z outcome
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1     1 0.734  1.54  -1.71 
## 2     1 0.738  1.54  -0.925
## 3     1 0.340  1.12   0.876
## 4     1 0.340  1.12   0.407
## 5     1 0.751  1.56   0.488
## 6     1 0.926  1.86  -1.41 
## 7     1 0.983  1.97   0.957
## 8     1 0.713  1.51  -0.945
```

]

---
name: tibble2

# More on Tibbles

* When you print a `tibble`:
  + all columns that fit the screen are shown,
  + first 10 rows are shown,
  + data type for each column is shown.


```r
as_tibble(cars) %&gt;% print(n = 5)
```

```
## # A tibble: 50 × 2
##   speed  dist
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     4     2
## 2     4    10
## 3     7     4
## 4     7    22
## 5     8    16
## # ℹ 45 more rows
```

* `my_tibble %&gt;% print(n = 50, width = Inf)`,
* `options(tibble.print_min = 15, tibble.print_max = 25)`,
* `options(dplyr.print_min = Inf)`,
* `options(tibble.width = Inf)`

---
name: tibble2

# Subsetting Tibbles


```r
vehicles &lt;- as_tibble(cars[1:5,])

vehicles[['speed']]
vehicles[[1]]
vehicles$speed

# Using placeholders

vehicles %&gt;% .$dist
vehicles %&gt;% .[['dist']]
vehicles %&gt;% .[[2]]
```

```
## [1] 4 4 7 7 8
## [1] 4 4 7 7 8
## [1] 4 4 7 7 8
## [1]  2 10  4 22 16
## [1]  2 10  4 22 16
## [1]  2 10  4 22 16
```

--

**Note!** Not all old R functions work with tibbles, than you have to use `as.data.frame(my_tibble)`.

---
name: tibbles_partial_matching

# Tibbles are Stricter than `data.frames`


```r
cars &lt;- cars[1:5,]
```

```r
cars$spe      # partial matching
```

```
## [1] 4 4 7 7 8
```

```r
vehicles$spe  # no partial matching
```

```
## Warning: Unknown or uninitialised column: `spe`.
```

```
## NULL
```

```r
cars$gear
```

```
## NULL
```

```r
vehicles$gear
```

```
## Warning: Unknown or uninitialised column: `gear`.
```

```
## NULL
```

---
name: loading_data

# Loading Data

In `tidyverse` you import data using `readr` package that provides a number of useful data import functions:
* `read_delim()` a generic function for reading *-delimited files. There are a number of convenience wrappers:
  + `read_csv()` used to read comma-delimited files,
  + `read_csv2()` reads semicolon-delimited files,
  `read_tsv()` that reads tab-delimited files.
* `read_fwf` for reading fixed-width files with its wrappers:
  + fwf_widths() for width-based reading,
  + fwf_positions() for positions-based reading and
  + read_table() for reading white space-delimited fixed-width files.
* `read_log()` for reading Apache-style logs.

--
The most commonly used `read_csv()` has some familiar arguments like:
* `skip` -- to specify the number of rows to skip (headers),
* `col_names` -- to supply a vector of column names,
* `comment` -- to specify what character designates a comment,
* `na` -- to specify how missing values are represented.

---
name: readr

# Importing Data Using `readr`

When reading and parsing a file, `readr` attempts to guess proper parser for each column by looking at the 1000 first rows.


```r
tricky_dataset &lt;- read_csv(readr_example('challenge.csv'))
```

```
## Rows: 2000 Columns: 2
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## dbl  (1): x
## date (1): y
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

OK, so there are some parsing failures. We can examine them more closely using `problems()` as suggested in the above output.

---
name: readr_problems

# Looking at Problematic Columns


```r
(p &lt;- problems(tricky_dataset))
```

```
## # A tibble: 0 × 5
## # ℹ 5 variables: row &lt;int&gt;, col &lt;int&gt;, expected &lt;chr&gt;, actual &lt;chr&gt;, file &lt;chr&gt;
```

OK, let's see which columns cause trouble:


```r
p %$% table(col)
```

```
## &lt; table of extent 0 &gt;
```

Looks like the problem occurs only in the `x` column.

---
name: readr_problems_fixing

# Fixing Problematic Columns

So, how can we fix the problematic columns?

1. We can explicitely tell what parser to use:


```r
tricky_dataset &lt;- read_csv(readr_example('challenge.csv'),
                           col_types = cols(x = col_double(),
                                            y = col_character()))
tricky_dataset %&gt;% tail(n = 5)
```

```
## # A tibble: 5 × 2
##       x y         
##   &lt;dbl&gt; &lt;chr&gt;     
## 1 0.164 2018-03-29
## 2 0.472 2014-08-04
## 3 0.718 2015-08-16
## 4 0.270 2020-02-04
## 5 0.608 2019-01-06
```

As you can see, we can still do better by parsing the `y` column as *date*, not as *character*.

---
name: readr_problems_fixing2

# Fixing Problematic Columns cted.

But knowing that the parser is guessed based on the first 1000 lines, we can see what sits past the 1000-th line in the data:


```r
tricky_dataset %&gt;% head(n = 1002) %&gt;% tail(n = 4)
```

```
## # A tibble: 4 × 2
##          x y         
##      &lt;dbl&gt; &lt;chr&gt;     
## 1 4569     &lt;NA&gt;      
## 2 4548     &lt;NA&gt;      
## 3    0.238 2015-01-16
## 4    0.412 2018-05-18
```

It seems, we were very unlucky, because up till 1000-th line there are only integers in the x column and `NA`s in the y column so the parser cannot be guessed correctly. To fix this:


```r
tricky_dataset &lt;- read_csv(readr_example('challenge.csv'),
                           guess_max = 1001)
```

```
## Rows: 2000 Columns: 2
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## dbl  (1): x
## date (1): y
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

---
name: readr_writing

# Writing to a File

The `readr` package also provides functions useful for writing tibbled data into a file:

* `write_csv()`
* `write_tsv()`
* `write_excel_csv()`

They **always** save:

* text in UTF-8,
* dates in ISO8601

But saving in csv (or tsv) does mean you loose information about the type of data in particular columns. You can avoid this by using:

* `write_rds()` and `read_rds()` to read/write objects in R binary rds format,
* use `write_feather()` and `read_feather()` from package `feather` to read/write objects in a fast binary format that other programming languages can access.

---
name: basic_data_transformations

# Basic Data Transformations with `dplyr`

Let us create a tibble:


```r
(bijou &lt;- as_tibble(diamonds) %&gt;% head(n = 10))
```

```
## # A tibble: 10 × 10
##    carat cut       color clarity depth table price     x     y     z
##    &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
##  2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
##  3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
##  4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
##  5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
##  6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
##  7  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
##  8  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
##  9  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
## 10  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39
```

.center[&lt;img src="data/slide_tidyverse/diamonds.png", style="height:200px"&gt;]

---
name: filter

# Picking Observations using `filter()`


```r
bijou %&gt;% filter(cut == 'Ideal' | cut == 'Premium', carat &gt;= 0.23) %&gt;% head(n = 5)
```

```
## # A tibble: 2 × 10
##   carat cut     color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal   E     SI2      61.5    55   326  3.95  3.98  2.43
## 2  0.29 Premium I     VS2      62.4    58   334  4.2   4.23  2.63
```

Be careful with floating point comparisons! Also, rows with comparison resulting in `NA` are skipped by default!


```r
bijou %&gt;% filter(near(0.23, carat) | is.na(carat)) %&gt;% head(n = 5)
```

```
## # A tibble: 3 × 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
## 2  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
## 3  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39
```

---
name: arrange

# Rearranging Observations using `arrange()`


```r
bijou %&gt;% arrange(cut, carat, desc(price))
```

```
## # A tibble: 10 × 10
##    carat cut       color clarity depth table price     x     y     z
##    &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
##  2  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31
##  3  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75
##  4  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39
##  5  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
##  6  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
##  7  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
##  8  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
##  9  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
## 10  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
```

The `NA`s always end up at the end of the rearranged tibble.

---
name: select

# Selecting Variables with `select()`

Simple `select` with a range:


```r
bijou %&gt;% select(color, clarity, x:z) %&gt;% head(n = 4)
```

```
## # A tibble: 4 × 5
##   color clarity     x     y     z
##   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 E     SI2      3.95  3.98  2.43
## 2 E     SI1      3.89  3.84  2.31
## 3 E     VS1      4.05  4.07  2.31
## 4 I     VS2      4.2   4.23  2.63
```

--

Exclusive `select`:

```r
bijou %&gt;% select(-(x:z)) %&gt;% head(n = 4)
```

```
## # A tibble: 4 × 7
##   carat cut     color clarity depth table price
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1  0.23 Ideal   E     SI2      61.5    55   326
## 2  0.21 Premium E     SI1      59.8    61   326
## 3  0.23 Good    E     VS1      56.9    65   327
## 4  0.29 Premium I     VS2      62.4    58   334
```

---
name: select2

# Selecting Variables with `select()` cted.

`rename` is a variant of `select`, here used with `everything()` to move `x` to the beginning and rename it to `var_x`


```r
bijou %&gt;% rename(var_x = x) %&gt;% head(n = 5)
```

```
## # A tibble: 5 × 10
##   carat cut     color clarity depth table price var_x     y     z
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal   E     SI2      61.5    55   326  3.95  3.98  2.43
## 2  0.21 Premium E     SI1      59.8    61   326  3.89  3.84  2.31
## 3  0.23 Good    E     VS1      56.9    65   327  4.05  4.07  2.31
## 4  0.29 Premium I     VS2      62.4    58   334  4.2   4.23  2.63
## 5  0.31 Good    J     SI2      63.3    58   335  4.34  4.35  2.75
```

--

use `everything()` to bring some columns to the front:


```r
bijou %&gt;% select(x:z, everything()) %&gt;% head(n = 4)
```

```
## # A tibble: 4 × 10
##       x     y     z carat cut     color clarity depth table price
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1  3.95  3.98  2.43  0.23 Ideal   E     SI2      61.5    55   326
## 2  3.89  3.84  2.31  0.21 Premium E     SI1      59.8    61   326
## 3  4.05  4.07  2.31  0.23 Good    E     VS1      56.9    65   327
## 4  4.2   4.23  2.63  0.29 Premium I     VS2      62.4    58   334
```

---
name: mutate

# Create/alter new Variables with `mutate`


```r
bijou %&gt;% mutate(p = x + z, q = p + y) %&gt;% select(-(depth:price)) %&gt;% head(n = 5)
```

```
## # A tibble: 5 × 9
##   carat cut     color clarity     x     y     z     p     q
##   &lt;dbl&gt; &lt;ord&gt;   &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0.23 Ideal   E     SI2      3.95  3.98  2.43  6.38  10.4
## 2  0.21 Premium E     SI1      3.89  3.84  2.31  6.2   10.0
## 3  0.23 Good    E     VS1      4.05  4.07  2.31  6.36  10.4
## 4  0.29 Premium I     VS2      4.2   4.23  2.63  6.83  11.1
## 5  0.31 Good    J     SI2      4.34  4.35  2.75  7.09  11.4
```

--

or with `transmute` (only the transformed variables will be retained)


```r
bijou %&gt;% transmute(carat, cut, sum = x + y + z) %&gt;% head(n = 5)
```

```
## # A tibble: 5 × 3
##   carat cut       sum
##   &lt;dbl&gt; &lt;ord&gt;   &lt;dbl&gt;
## 1  0.23 Ideal    10.4
## 2  0.21 Premium  10.0
## 3  0.23 Good     10.4
## 4  0.29 Premium  11.1
## 5  0.31 Good     11.4
```

---
name: grouped_summaries

# Group and Summarize


```r
bijou %&gt;% group_by(cut) %&gt;% summarize(max_price = max(price),
                                      mean_price = mean(price),
                                      min_price = min(price))
```

```
## # A tibble: 5 × 4
##   cut       max_price mean_price min_price
##   &lt;ord&gt;         &lt;int&gt;      &lt;dbl&gt;     &lt;int&gt;
## 1 Fair            337       337        337
## 2 Good            335       331        327
## 3 Very Good       338       337.       336
## 4 Premium         334       330        326
## 5 Ideal           326       326        326
```

--


```r
bijou %&gt;% group_by(cut, color) %&gt;%
  summarize(max_price = max(price),
            mean_price = mean(price),
            min_price = min(price)) %&gt;% head(n = 4)
```

```
## # A tibble: 4 × 5
## # Groups:   cut [3]
##   cut       color max_price mean_price min_price
##   &lt;ord&gt;     &lt;ord&gt;     &lt;int&gt;      &lt;dbl&gt;     &lt;int&gt;
## 1 Fair      E           337       337        337
## 2 Good      E           327       327        327
## 3 Good      J           335       335        335
## 4 Very Good H           338       338.       337
```

---
name: other_data_manipulations

# Other data manipulation tips


```r
bijou %&gt;% group_by(cut) %&gt;% summarize(count = n())
```

```
## # A tibble: 5 × 2
##   cut       count
##   &lt;ord&gt;     &lt;int&gt;
## 1 Fair          1
## 2 Good          2
## 3 Very Good     4
## 4 Premium       2
## 5 Ideal         1
```

--

When you need to regroup within the same pipe, use `ungroup()`.

---
name: concept_of_tidy_data

# The Concept of Tidy Data

Data are tidy *sensu Wickham* if:
* each and every observation is represented as exactly one row,
* each and every variable is represented by exactly one column,
* thus each data table cell contains only one value.
&lt;img src="data/slide_tidyverse/tidy_data.png" width="2560" style="display: block; margin: auto auto auto 0;" /&gt;

Usually data are untidy in only one way. However, if you are unlucky, they are really untidy and thus a pain to work with...

---
name: tidy_data

# Tidy Data

&lt;img src="data/slide_tidyverse/tidy_data.png" style="height:100px"&gt;

--

.center[**Are these data tidy?**]

.pull-left-70[
&lt;table class="table table-striped table-hover table-responsive table-condensed" style=""&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; Sepal.Length &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Sepal.Width &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Petal.Length &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Petal.Width &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Species &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; 5.1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.5 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.4 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; 4.9 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.0 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.4 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; 4.7 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.3 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--

.pull-right-30[

&lt;table class="table table-striped table-hover table-responsive table-condensed" style=""&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; Species &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; variable &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Sepal.Length &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 5.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Sepal.Length &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; Sepal.Length &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.7 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

&lt;br&gt;&amp;nbsp;&lt;hr&gt;&lt;br&gt;

--
.pull-left-50[

&lt;table class="table table-striped table-hover table-responsive table-condensed" style=""&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; Sepal.L.W &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Petal.L.W &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Species &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; 5.1/3.5 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.4/0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; 4.9/3 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.4/0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; 4.7/3.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.3/0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

--

.pull-right-50[
&lt;table class="table table-striped table-hover table-responsive table-condensed" style=""&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sepal.Length &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 5.1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.9 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.7 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sepal.Width &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.5 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.0 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Petal.Length &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.4 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.4 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.3 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Petal.Width &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Species &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; setosa &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

]

---
name: tidying_data_pivot_longer

# Tidying Data with `tidyr::pivot_longer`

If some of your column names are actually values of a variable, use `pivot_longer` (replaces `gather`):



```r
bijou2 %&gt;% head(n = 5)
```

```
## # A tibble: 5 × 3
##   cut     `2008` `2009`
##   &lt;ord&gt;    &lt;int&gt;  &lt;dbl&gt;
## 1 Ideal      326   330.
## 2 Premium    326   330.
## 3 Good       327   331.
## 4 Premium    334   338.
## 5 Good       335   339.
```

```r
bijou2 %&gt;%
  pivot_longer(c(`2008`, `2009`), names_to = 'year', values_to = 'price') %&gt;%
  head(n = 5)
```

```
## # A tibble: 5 × 3
##   cut     year  price
##   &lt;ord&gt;   &lt;chr&gt; &lt;dbl&gt;
## 1 Ideal   2008   326 
## 2 Ideal   2009   330.
## 3 Premium 2008   326 
## 4 Premium 2009   330.
## 5 Good    2008   327
```

---
name: tidying_data_pivot_wider

# Tidying Data with `tidyr::pivot_wider`

If some of your observations are scattered across many rows, use `pivot_wider` (replaces `gather`):




```r
bijou3
```

```
## # A tibble: 9 × 5
##   cut     price clarity dimension measurement
##   &lt;ord&gt;   &lt;int&gt; &lt;ord&gt;   &lt;chr&gt;           &lt;dbl&gt;
## 1 Ideal     326 SI2     x                3.95
## 2 Premium   326 SI1     x                3.89
## 3 Good      327 VS1     x                4.05
## 4 Ideal     326 SI2     y                3.98
## 5 Premium   326 SI1     y                3.84
## 6 Good      327 VS1     y                4.07
## 7 Ideal     326 SI2     z                2.43
## 8 Premium   326 SI1     z                2.31
## 9 Good      327 VS1     z                2.31
```


```r
bijou3 %&gt;%
  pivot_wider(names_from=dimension, values_from=measurement) %&gt;%
  head(n = 4)
```

```
## # A tibble: 3 × 6
##   cut     price clarity     x     y     z
##   &lt;ord&gt;   &lt;int&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ideal     326 SI2      3.95  3.98  2.43
## 2 Premium   326 SI1      3.89  3.84  2.31
## 3 Good      327 VS1      4.05  4.07  2.31
```

---
name: tidying_data_separate

# Tidying Data with `separate`

If some of your columns contain more than one value, use `separate`:



```r
bijou4
```

```
## # A tibble: 5 × 4
##   cut     price clarity dim           
##   &lt;ord&gt;   &lt;int&gt; &lt;ord&gt;   &lt;chr&gt;         
## 1 Ideal     326 SI2     3.95/3.98/2.43
## 2 Premium   326 SI1     3.89/3.84/2.31
## 3 Good      327 VS1     4.05/4.07/2.31
## 4 Premium   334 VS2     4.2/4.23/2.63 
## 5 Good      335 SI2     4.34/4.35/2.75
```

```r
bijou4 %&gt;%
  separate(dim, into = c("x", "y", "z"), sep = "/", convert = T)
```

```
## # A tibble: 5 × 6
##   cut     price clarity     x     y     z
##   &lt;ord&gt;   &lt;int&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ideal     326 SI2      3.95  3.98  2.43
## 2 Premium   326 SI1      3.89  3.84  2.31
## 3 Good      327 VS1      4.05  4.07  2.31
## 4 Premium   334 VS2      4.2   4.23  2.63
## 5 Good      335 SI2      4.34  4.35  2.75
```

---
name: tidying_data_separate

# Tidying Data with `unite`

If some of your columns contain more than one value, use `separate`:



```r
bijou5
```

```
## # A tibble: 5 × 7
##   cut     price clarity_prefix clarity_suffix     x     y     z
##   &lt;ord&gt;   &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ideal     326 SI             2               3.95  3.98  2.43
## 2 Premium   326 SI             1               3.89  3.84  2.31
## 3 Good      327 VS             1               4.05  4.07  2.31
## 4 Premium   334 VS             2               4.2   4.23  2.63
## 5 Good      335 SI             2               4.34  4.35  2.75
```

```r
bijou5 %&gt;% unite(clarity, clarity_prefix, clarity_suffix, sep='')
```

```
## # A tibble: 5 × 6
##   cut     price clarity     x     y     z
##   &lt;ord&gt;   &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Ideal     326 SI2      3.95  3.98  2.43
## 2 Premium   326 SI1      3.89  3.84  2.31
## 3 Good      327 VS1      4.05  4.07  2.31
## 4 Premium   334 VS2      4.2   4.23  2.63
## 5 Good      335 SI2      4.34  4.35  2.75
```

**Note:** that `sep` is here interpreted as the position to split on. It can also be a *regular expression* or a delimiting string/character. Pretty flexible approach!

---
name: missing_complete

# Completing Missing Values Using `complete`



```r
bijou %&gt;% head(n = 10) %&gt;%
  select(cut, clarity, price) %&gt;%
  mutate(continent = sample(c('AusOce', 'Eur'),
                            size = 10,
                            replace = T)) -&gt; missing_stones
```

```r
missing_stones %&gt;% complete(cut, continent)
```

```
## # A tibble: 13 × 4
##    cut       continent clarity price
##    &lt;ord&gt;     &lt;chr&gt;     &lt;ord&gt;   &lt;int&gt;
##  1 Fair      AusOce    &lt;NA&gt;       NA
##  2 Fair      Eur       VS2       337
##  3 Good      AusOce    &lt;NA&gt;       NA
##  4 Good      Eur       VS1       327
##  5 Good      Eur       SI2       335
##  6 Very Good AusOce    SI1       337
##  7 Very Good AusOce    VS1       338
##  8 Very Good Eur       VVS2      336
##  9 Very Good Eur       VVS1      336
## 10 Premium   AusOce    SI1       326
## 11 Premium   Eur       VS2       334
## 12 Ideal     AusOce    SI2       326
## 13 Ideal     Eur       &lt;NA&gt;       NA
```

---
name: more_tidyverse

# Some Other Friends

* `stringr` for string manipulation and regular expressions,
* `forcats` for working with factors,
* `lubridate` for working with dates.

---
name: end-slide
class: end-slide

# Thank you. Questions?


.end-text[
&lt;p class="smaller"&gt;
&lt;span class="small" style="line-height: 1.2;"&gt;Graphics from &lt;/span&gt;&lt;img src="./assets/freepik.jpg" style="max-height:20px; vertical-align:middle;"&gt;&lt;br&gt;
Created: 09-Aug-2023 • Roy Francis • &lt;a href="https://www.scilifelab.se/"&gt;SciLifeLab&lt;/a&gt; • &lt;a href="https://nbis.se/"&gt;NBIS&lt;/a&gt;
&lt;/p&gt;
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="assets/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "4:3",
"highlightLanguage": "r",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%/%total%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
