<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

  <meta name="theme-color" content="#ffffff">

  <title>Create plots</title>
  <meta name="description" content="">

  <link rel="canonical" href="./Exercises/PlotHandson.html">
  <!-- CSS  -->
  <link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">

    <!-- Custom Fonts -->
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

    <link href="./workshop-common/css/main.css" type="text/css" rel="stylesheet" media="screen,projection"/>
</head>

  <body>
    <!-- define dropdowns first -->

  

  

  

  


<div>
  <nav class="z-depth-0  main  " role="navigation">
    <div class="nav-wrapper">
      <a href="./" class="left navlogo"><img src="./workshop-common/assets/img/logo/nbislogo-green.svg" style="height:48px;margin-top:8px;padding:0px;margin-left:8px"></a>
      <ul class="right hide-on-med-and-down">
      
        
          <li><a href="./index.html">Overview</a></li>
        
      
        
          <li><a href="./schedule.html">Schedule</a></li>
        
      
        
          <li><a href="./precourse.html">Pre-course material</a></li>
        
      
        
          <li><a href="./travel.html">Travel info</a></li>
        
      
      </ul>

      <a href="#" data-activates="nav-mobile" class="button-collapse right"><i class="material-icons">menu</i></a>
    </div>
  </nav>
</div>
      <ul id="nav-mobile" class="side-nav">
      
        
          <li class="no-padding"><a style="padding: 0px 16px" href="./index.html">Overview</a></li>
        
      
        
          <li class="no-padding"><a style="padding: 0px 16px" href="./schedule.html">Schedule</a></li>
        
      
        
          <li class="no-padding"><a style="padding: 0px 16px" href="./precourse.html">Pre-course material</a></li>
        
      
        
          <li class="no-padding"><a style="padding: 0px 16px" href="./travel.html">Travel info</a></li>
        
      
      </ul>


  
  <div class="l2 s12">
    <div id="toc-sidebar">
        <ul id="toc"></ul>
    </div>
</div>

  
  <div class="container">
    <div class="row"></div>
    <div class="row">
      
      <div class="col s12 l10 z-depth-2 content">
      
        <h1 id="introduction">Introduction<a id="orgheadline1"></a>
</h1>
<p>In this lab, we will go step-by-step through points that are necessary
to create some nice-looking plots.</p>

<h1 id="generating-data">Generating data<a id="orgheadline2"></a>
</h1>
<p>First, we will produce some random data that we will later plot. 
Make a data frame with</p>

<ul>
  <li>20 random coordinates (x,y) and</li>
  <li>radius $r$ for each data point.</li>
  <li>The <em>x</em> coord takes random values from 1 to 25 and</li>
  <li>both the <em>y</em> and the radius <em>r</em> coord are samples from $N(0,1)$.</li>
  <li>Each point (row of the data frame) has a name <em>ind1 … ind25</em>,</li>
</ul>

<p>First, look at the defaults:</p>

<ul>
  <li>plot the data in the simplest possible way.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
#20 random datapoints
x &lt;- sample(c(1:25), size=20, replace=T)
y &lt;- rnorm(n=20, mean=0, sd=1) # sample from normal
r &lt;- rnorm(n=20, mean=0, sd=1) # radius from normal
names &lt;- paste("ind", 1:20, sep="") # assign some names
data &lt;- data.frame(cbind(X=x,Y=y, R=r), row.names=names)
plot(data[,1:2])
</pre>
</details>
    <p><br></p>
  </li>
</ul>

<h1 id="generating-plot-step-by-step">Generating plot step-by-step<a id="orgheadline3"></a>
</h1>
<p>As you see, the points are displayed in a simple way, axes are set
automatically, the radius is not reflected on the plot in any way (3rd
dimension).</p>

<ul>
  <li>build the plot from scratch, begin by displaying no points.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
plot(data[,1:2], type='n')
</pre>
</details>
    <p><br></p>
  </li>
  <li>we still got a box around the plot and axes, we do not want these
either, remove these elements from the previous plot.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
plot(data[,1:2], type='n',xaxt='n', yaxt='n', 
   xlab="", ylab="", frame.plot=F)
</pre></details>
  </li>
</ul>
<p>&lt;/pre&gt;
 &lt;/details&gt;
<br></p>

<ul>
  <li>create X and Y axis so that they cover the whole range of <em>x</em> and
<em>y</em>. Make axis text slightly smaller, 70% of the default. For the Y
axis, set 10 equidistant tickmarks and set labels to their values
rounded to two decimals. Turn the labels, so that they are parallel
to the OX axis.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
#Create X axis
coords.x &lt;- seq(min(data$X),max(data$X), by=1)
axis(side=1, # 1-left, 2-top, 3-right, 4-bottom
    at=coords.x, # coordinates for tickmarks
    cex.axis=.7 # make labels smaller
   )
#Create Y axis
#we want 10 tickmarks along the data range
coords.y &lt;- seq(min(data$Y), max(data$Y), length.out=10)
#and our labels will be the rounded values of y
labels.y &lt;- round(coords.y, digits=2)
axis(side=2, 
    at=coords.y,
    labels=labels.y, # we want specific labels
    las=2 # turn the text so it is parallel to OX
   )
</pre>
</details>
    <p><br></p>
  </li>
  <li>plot auxiliary lines (a grid) so that it is easier to read the
plot. There should be a grey dashed line from each tickmark on both
axes.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
abline(v=coords.x, col="darkgrey", lty=3)
abline(h=coords.y, col="darkgrey", lty=3)
#you could also use grid()
</pre>
</details>
    <p><br></p>
  </li>
  <li>define a new <em>mycol</em> function that takes a color name and a
transparency value as two arguments and returns the corresponding
rgb color value. OPTIONAL – if it seems to difficult, look up the
answer.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
#Function for adding transparency to a given color.
mycol &lt;- function(colname="olivedrab", transparency=.5) {
      #convert color name to its RGB value and add the desired
      #transparency
          color &lt;- c(as.vector(col2rgb(colname))/255, transparency)
    # and make a new color from the above
          color &lt;- rgb(color[1], color[2], color[3], color[4])
      return(color)
 }
 </pre>
 </details>
    <p><br></p>
  </li>
  <li>plot datapoints so that their size is proportional to $e^r$ where
$r$ is the radius, points at even X should be round and blue and
points at odd X square and grey.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
#Plot radii
points(data[data$X%%2 == 0,], pch=19, 
      cex=exp(r), col=mycol("slateblue", .5))
  points(data[data$X%%2 != 0,], pch=15, 
      cex=exp(r), col=mycol("grey", .5))
 </pre>
 </details>
    <p><br></p>
  </li>
  <li>plot centers of the points as a cross: grey for blue/even points and
red for grey/odd points.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
points(data[data$X%%2 == 0,], pch=3, cex=1, col="darkgrey")
points(data[data$X%%2 != 0,], pch=3, cex=1, col="red")
</pre>
</details>
    <p><br></p>
  </li>
  <li>add grey text ‘Center’ at the center of the plot.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
center.x &lt;- mean(range(data[,1]))
center.y &lt;- mean(range(data[,2]))
text(x=center.x, y=center.y, "Center", col="lightgrey")
</pre>
</details>
    <p><br></p>
  </li>
  <li>add title ‘Odds and Ends’ and text ‘X’ and ‘Y’ on the margins of the
appropriate axes.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>
title("Odds and Ends")
mtext("Y", side=2, line=3, cex.lab=1,las=2, col="blue")
mtext("X", side=1, line=3, cex.lab=1,las=1, col="blue")
</pre>
</details>
    <p><br></p>
  </li>
  <li>add a legend for ‘odd’ and ‘even’ points. Place it in the top-right
corner.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

  legend('topright',
      legend=c("odd", "even"), 
      col=c(mycol("slateblue", .5), mycol("grey", .5)),
      pch=c(19,15), 
      cex=1,
      pt.cex=1.2,
      title="Legend",
      bty='n'
     )
</pre>
</details>
    <p><br></p>
  </li>
</ul>

<h1 id="visualizing-baby-growth-data-on-a-who-centile-grid">Visualizing baby growth data on a WHO centile grid<a id="orgheadline4"></a>
</h1>

<p>A female child was measured at the following dates:</p>

<ul>
  <li>
    <p>‘30-09-2015’, ‘12-10-2015’, ‘19-10-2015’, ‘26-10-2015’,
‘07-11-2015’, ‘16-11-2015’, ‘30-11-2015’, ‘11-01-2016’,
‘08-02-2016’, ‘14-03-2016’, ‘05-04-2016’, ‘14-04-2016’,
‘31-05-2016’, ‘14-07-2016’,</p>
  </li>
  <li>the measured weights in grams were: 3300, 3540, 3895, 4070, 4230,
4385, 4855, 5865, not taken, 6736, 7065, 7080, 7530, 7640 and</li>
  <li>the measured lengths: 43, no measurement taken, 53, 54, 55, 56, 58,
62.5, 65, 67, 67.5, 67.5, 70.5, 71.5.</li>
  <li>The headcircumference for the same datapoints was (in cm): 34, 35.5,
36.1, 36.8, 36.8, 37.3, 38, 40.2, 41.4, 42.1, not taken, 43, 44, 45.</li>
</ul>

<p>Your task is to plot these data on the WHO centile grids. Choose
weight/length/circumference depending on the month you was born:</p>

<ul>
  <li>weight: Jan, Apr, Jul, Oct</li>
  <li>length: Feb, May, Aug, Nov</li>
  <li>circumference: Mar, Jun, Sep, Dec</li>
</ul>

<p>Good luck!</p>

<ol>
  <li>use function <em>dmy</em> from the <em>lubridate</em> package to create a vector of timepoints.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

 library(lubridate) 
 timepoints &lt;- dmy(c('30-09-2015', '12-10-2015',
 '19-10-2015', '26-10-2015', '07-11-2015', '16-11-2015',
 '30-11-2015', '11-01-2016', '08-02-2016', '14-03-2016',
 '05-04-2016', '14-04-2016', '31-05-2016', '14-07-2016'))

</pre>
</details>
    <p><br></p>
  </li>
  <li>enter the measurement of choice as a vector
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

 weight &lt;- c(3300, 3540, 3895, 4070, 4230, 4385, 4855, 5865, NA, 6736, 7065, 7080, 7530, 7640)
 length &lt;- c(43,NA,53,54,55,56,58,62.5,65,67,67.5,67.5,70.5,71.5)
 head &lt;- c(34,35.5,36.1,36.8,36.8,37.3,38,40.2,41.4,42.1,NA,43,44,45)
   
</pre>
</details>
    <p><br></p>
  </li>
  <li>WHO months is 30.4375 days long. Transform timepoints into OX
coordinates so that the distance between them corresponds to the
days between the two measurements. HINT: check <em>as.duration</em> and
<em>ddays</em> functions. Do not feel bad if you have to click on the
key. Working with dates is not an easy piece. The point is to know
the <em>lubridate</em> exists…
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

 who.month &lt;- 30.4375 #days
 xpoints &lt;- as.duration(timepoints[1] %--% timepoints) / ddays(1) / who.month

</pre>
</details>
    <p><br></p>
  </li>
  <li>
    <p>go to WHO website (http://www.who.int/childgrowth/standards/en/)
and find out the link to the dataset of your concern, e.g. Weight
for age, percentiles for girls have the following address:
http://www.who.int/entity/childgrowth/standards/tab_wfa_girls_p_0_5.txt</p>
  </li>
  <li>load the data using URL from the previous point and the
<em>read.table</em> function.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

 uri &lt;- "http://www.who.int/entity/childgrowth/standards/tab_wfa_girls_p_0_5.txt"
 #uri &lt;- "http://www.who.int/entity/childgrowth/standards/second_set/tab_hcfa_girls_p_0_5.txt"
 #uri &lt;- "http://www.who.int/entity/childgrowth/standards/tab_lhfa_girls_p_0_2.txt"
 myData &lt;-read.table(uri, header=T, sep='\t')

</pre>
</details>
    <p><br></p>
  </li>
  <li>create an empty plot to show your and WHO data,
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

 plot(1, xlim=c(0, max(myData$Month)), type='n', bty='n', 
 ylim=c(0, max(myData[,c(5:19)])), las=1, xlab='Month', ylab='kg',
 cex.axis=.7)
 grid()

</pre>
</details>
    <p><br></p>
  </li>
  <li>plot WHO mean and percentiles: P25, P75, P0.1 and P99.9, use
different colors and line types to make the plot pretty.
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

 lines(myData$M, col='grey', lty=1)
 lines(myData$P25, col='blue', lty=2)
 lines(myData$P75, col='blue', lty=2)
 lines(myData$P01, col='tomato', lty=2)
 lines(myData$P999, col='tomato', lty=2)

</pre>
</details>
    <p><br></p>
  </li>
  <li>plot your data on top of the percentiles, mind the units so that
they match with the WHO ones,
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

 points(xpoints, weight/1000, pch=3, type='l', cex=.5)
 points(xpoints, weight/1000, pch=3, type='p', cex=.5)

</pre>
</details>
    <p><br></p>
  </li>
  <li>add some descriptions on the margins
    <details>
<summary><img class="emoji" title=":key:" alt=":key:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f511.png" height="20" width="20"> Click to see how</summary>
<pre>

 mtext(text = c('P0.1','P25','P75','P99.9'), side = 4,
 at=myData[dim(myData)[1], c('P01','P25','P75','P999')], 
 las=1, cex=.5)
</pre> 
</details>
    <p><br></p>
  </li>
</ol>

<h1 id="visualizing-gapminder-data">Visualizing Gapminder data<a id="orgheadline4"></a>
</h1>
<p>You task here is to use the already acquired R knowledge to plot an
interesting relationship between two freely selected variables
available at Hans Rosling’s Gapminder Foundation page.</p>

<ul>
  <li>go to http://www.gapminder.org/data/</li>
  <li>select a dataset of interest,</li>
  <li>load data to R, take care of missing values etc.,</li>
  <li>find a nice way of visualizing the relationship between some
selected variables,</li>
  <li>think of scales (linear, logarythmic), axes labels etc.,</li>
  <li>be creative,</li>
  <li>visualize a selected variables using boxplot and histogram on one
plot (HINT: parameter mfrow),</li>
  <li>discuss the result with your colleagues and TAs.</li>
</ul>

      </div>
    </div>
  </div>

    <footer class="page-footer topborder">
    <div class="container">
      <div class="row">
        <div class="col s12">
          <h5 class="white-text">NBIS</h5>
          <p class="grey-text text-lighten-4">NBIS is a distributed national bioinformatics infrastructure, supporting life sciences in Sweden.</p>
        </div>
      </div>
    </div>
    <div id="funding" class="row">
      <div class="center-block">
        <p class="logos">
          <a href="http://www.vr.se"><img alt="Vetenskapsrådet" src="./workshop-common/assets/img/logo/vetenskapsradet-logotyp.png" style="height:65px;padding:5px"></a>
          <a href="http://www.scilifelab.se"><img alt="Scilifelab" src="./workshop-common/assets/img/logo/scilifelab.jpg" style="height:40px;padding:5px 0px 5px 0px"></a>
          <a href="http://www.liu.se"><img alt="Linköping University" src="./workshop-common/assets/img/logo/liu.jpg" style="height:65px;padding:5px"></a>
          <a href="http://www.chalmers.se"><img alt="Chalmers University" src="./workshop-common/assets/img/logo/chalmers.png" style="height:65px;padding:5px"></a>
          <a href="http://www.gu.se"><img alt="University of Gothenburg" src="./workshop-common/assets/img/logo/gu.jpg" style="height:65px;padding:5px"></a>
          <a href="http://www.ki.se"><img alt="Karolinska Institutet" src="./workshop-common/assets/img/logo/ki.png" style="height:65px;padding:0px 5px 0px 5px"></a>
          <a href="http://www.kth.se"><img alt="KTH Royal Institute of Technology" src="./workshop-common/assets/img/logo/kth.png" style="height:65px;padding:5px"></a>
          <a href="http://www.lu.se"><img alt="Lund University" src="./workshop-common/assets/img/logo/lu.jpg" style="height:65px;padding:5px 0px 5px 0px"></a>
          <a href="http://www.nrm.se"><img alt="Swedish Museum of Natural History" src="./workshop-common/assets/img/logo/nrm.gif" style="height:65px;padding:0px 0px 0px 0px"></a>
          <a href="http://www.slu.se"><img alt="Swedish University of Agricultural Sciences" src="./workshop-common/assets/img/logo/slu.png" style="height:65px;padding:0px 5px 0px 0px"></a>
          <a href="http://www.su.se"><img alt="Stockholm University" src="./workshop-common/assets/img/logo/su.png" style="height:65px;padding:5px 0px 5px 5px"></a>
          <a href="http://www.umu.se"><img alt="Umeå University" src="./workshop-common/assets/img/logo/umu.jpg" style="height:65px;padding:5px 0px 5px 0px"></a>
          <a href="http://www.uu.se"><img alt="Uppsala University" src="./workshop-common/assets/img/logo/uu.png" style="height:65px;padding:5px"></a>
          <a href="https://www.wallenberg.com/kaw/en"><img alt="Knuth and Alice Wallenberg Foundation" src="./workshop-common/assets/img/logo/kaw.png" style="height:65px;padding:5px"></a>
          <!-- <a href="http://www.elixir-europe.org"><img alt="ELIXIR" src="./workshop-common/assets/img/logo/elixir.png" style="height:65px;padding:5pxi;float:right" ></a> -->
        </p>
      </div>
    </div>
  </footer>


  <!--  Scripts-->
  

  <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

  <!--  Additional scripts for page -->
  

  <!-- This needs to be loaded last -->
  <script src="./workshop-common/assets/js/init.js"></script>


  </body>
</html>
